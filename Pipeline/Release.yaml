steps:
- task: AzureResourceManagerTemplateDeployment@3
  displayName: 'ARM Template deployment: Resource Group - RG-WVD-DEVOPS-Hosts'
  inputs:
    azureResourceManagerConnection: ''
    subscriptionId: '$(ARM_Subscription_ID)'
    resourceGroupName: '$(HostRG)'
    location: '$(location)'
    csmFile: '$(System.DefaultWorkingDirectory)/Latest Windows 10 2004 Artifacts/Build Image/mainTemplate.json'
    overrideParameters: '-nestedTemplatesLocation "https://raw.githubusercontent.com/Azure/RDS-Templates/master/ARM-wvd-templates/nestedtemplates/" -artifactsLocation "https://raw.githubusercontent.com/Azure/RDS-Templates/master/ARM-wvd-templates/DSC/Configuration.zip" -subscription $(ARM_Subscription_ID) -resourceGroup $(HostRG) -hostpoolName $(HostPoolName) -hostpoolFriendlyName "" -hostpoolDescription "" -location $location -workSpaceName $(Workspace) -workspaceLocation $location -workspaceResourceGroup $(wvd_goldimage_rg) -allApplicationGroupReferences "" -addToWorkspace true -administratorAccountUsername $(DomainJoinAccountUpn) -administratorAccountPassword $(DomainJoinAccountPassword) -createAvailabilitySet true -vmResourceGroup $(HostRG) -vmLocation $location -vmSize Standard_D2s_v3 -vmNumberOfInstances 1 -vmNamePrefix VM-WVD-$(Release.ReleaseName) -vmImageType CustomImage -vmGalleryImageOffer "" -vmGalleryImagePublisher "" -vmGalleryImageSKU "" -vmImageVhdUri "" -vmCustomImageSourceId /subscriptions/$(ARM_Subscription_ID)/resourceGroups/RG-WVD-DEVOPS/providers/Microsoft.Compute/galleries/$(gallery_name)/images/$(imageDefinitionName) -vmDiskType Premium_LRS -vmUseManagedDisks true -storageAccountResourceGroupName "" -existingVnetName $(VNetName) -existingSubnetName default -virtualNetworkResourceGroupName $(VnetRG) -usePublicIP false -publicIpAddressSku "Basic" -publicIpAddressType "Dynamic" -createNetworkSecurityGroup false -networkSecurityGroupId "" -networkSecurityGroupRules [] -hostpoolType Pooled -personalDesktopAssignmentType "" -maxSessionLimit 20 -loadBalancerType "BreadthFirst" -customRdpProperty "" -vmTemplate "{\"domain\":\"wvddemo.local\",\"galleryImageOffer\":null,\"galleryImagePublisher\":null,\"galleryImageSKU\":null,\"imageType\":\"CustomImage\",\"imageUri\":null,\"customImageId\": \"/subscriptions/$(ARM_Subscription_ID)/resourceGroups/RG-WVD-DEVOPS/providers/Microsoft.Compute/galleries/$(gallery_name)/images/$(imageDefinitionName)\",\"namePrefix\":\"wvd-do\",\"osDiskType\":\"StandardSSD_LRS\",\"useManagedDisks\":true,\"vmSize\":{\"id\":\"Standard_D2s_v3\",\"cores\":2,\"ram\":8},\"galleryItemId\":null}" -tokenExpirationTime 2020-08-08T15:16:14.995Z -hostpoolTags {} -applicationGroupTags {} -availabilitySetTags {} -networkInterfaceTags {} -networkSecurityGroupTags {} -publicIPAddressTags {} -virtualMachineTags {} -imageTags {} -apiVersion "2019-12-10-preview" -deploymentId "" -validationEnvironment false -preferredAppGroupType "Desktop" -ouPath "" -domain $(domain)'
